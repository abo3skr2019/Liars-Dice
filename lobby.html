<!DOCTYPE html>
<html lang="en">
<head>
  <title>Lobby</title>
  <script src="https://unpkg.com/peerjs@1.5.1/dist/peerjs.min.js"></script>
  <link rel="stylesheet" href="lobby.css">
</head>
<body>
<div id="gamediv">
    <h1>Game</h1>
</div>
<div id = "lobbydiv">
  <h1>Lobby</h1>

  <div id="peer-id"></div>

  <form id="nickname-form">
    <label for="nickname">Enter your nickname:</label>
    <input type="text" id="nickname" name="nickname" required>
    <button type="submit">Set Nickname</button>
  </form>

  <button id="start-game">Start Game</button>

  <form id="gameid-form">
    <label for="gameid">Enter game ID:</label>
    <input type="text" id="gameid" name="gameid" required>
    <button id="join-game" disabled>Join Game</button>
  </form>

  <div id="chat-box" style="height: 300px; overflow: auto; border: 1px solid black; margin-top: 20px; display: none;"></div>

  <form id="message-form" style="margin-top: 20px;">
    <input type="text" id="message" disabled>
    <button type="submit" disabled>Send</button>
  </form>
</div>

  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const startGameButton = document.querySelector('#start-game');
        const lobbyDiv = document.querySelector('#lobbydiv');
        const gameDiv = document.querySelector('#gamediv');
      
        // Hide the gameDiv by default
        gameDiv.style.display = 'none';
      
        startGameButton.addEventListener('click', () => {
          // Hide the lobby and show the game when the button is clicked
          lobbyDiv.style.display = 'none';
          gameDiv.style.display = 'block';
        });
      });
      
    const nicknameForm = document.querySelector('#nickname-form');
    const gameIdForm = document.querySelector('#gameid-form');
    const messageForm = document.querySelector('#message-form');
    const chatBox = document.querySelector('#chat-box');
    const peerIdElement = document.querySelector('#peer-id');
    let peer, conn;

    nicknameForm.addEventListener('submit', function(event) {
      event.preventDefault();

      const nicknameInput = document.getElementById('nickname');
      const nickname = nicknameInput.value;

      peer = new Peer();

      peer.on('open', (id) => {
        console.log('Connected with ID:', id);
        peerIdElement.textContent = `Peer ID: ${id}`; // Update the peer id div
      });

      peer.on('error', (error) => {
        console.error('PeerJS error:', error);
      });
      peer.on('connection', (connection) => {
        conn = connection;
      
        document.getElementById('message').disabled = false;
        document.querySelector('#message-form button').disabled = false;
        document.getElementById('chat-box').style.display = 'block';
      
        conn.on('data', (data) => {
          const messageElement = document.createElement('p');
          messageElement.textContent = data;
          chatBox.appendChild(messageElement);
          chatBox.scrollTop = chatBox.scrollHeight;
        });
      });
      window.nickname = nickname;
      document.getElementById('join-game').disabled = false;
    });

    gameIdForm.addEventListener('submit', function(event) {
        event.preventDefault();
    
        const gameIdInput = document.getElementById('gameid');
        const gameId = gameIdInput.value;
    
        if (gameId) {
            conn = peer.connect(gameId);
    
            conn.on('open', () => {
                conn.send(`${window.nickname} has joined the game`);
                document.getElementById('message').disabled = false;
                document.querySelector('#message-form button').disabled = false;
                document.getElementById('chat-box').style.display = 'block';
            });
    
            conn.on('data', (data) => {
                const messageElement = document.createElement('p');
                messageElement.textContent = data;
                chatBox.appendChild(messageElement);
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        } else {
            console.error('Game ID is required to connect.');
        }
    });

// JavaScript
    messageForm.addEventListener('submit', function(event) {
    event.preventDefault();
  
    const messageInput = document.getElementById('message');
    const message = messageInput.value;
    const nickname = window.nickname;
  
    if (conn) { // Check if conn is defined
        conn.send(`${nickname} : ${message}`);
    
        const messageElement = document.createElement('p');
        messageElement.textContent = `You: ${message}`;
        messageElement.classList.add('sent-message'); // Add class
        chatBox.appendChild(messageElement);
        chatBox.scrollTop = chatBox.scrollHeight;
      } else {
        console.error('Connection not established. Please enter a game ID first.');
      }
    messageInput.value = '';
  });
  
  </script>
</body>
</html>